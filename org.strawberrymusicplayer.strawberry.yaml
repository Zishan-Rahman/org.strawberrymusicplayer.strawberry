app-id: org.strawberrymusicplayer.strawberry
runtime: org.kde.Platform
runtime-version: '6.4'
sdk: org.kde.Sdk
rename-icon: strawberry
command: start-strawberry
cleanup:
  - /include
  - /lib/cmake
  - /lib/pkgconfig
  - /share/info
  - /share/man
  - /share/tagparser
  - /share/c++utilities
  - /bin/mmc-tool
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pulseaudio
  - --device=all
  - --share=network
  - --filesystem=xdg-music
  - --filesystem=/mnt
  - --filesystem=/media
  - --filesystem=/run/media
  - --system-talk-name=org.freedesktop.Avahi
  - --talk-name=org.freedesktop.Notifications
  - --system-talk-name=org.freedesktop.UDisks2
  - --talk-name=org.gnome.SettingsDaemon.MediaKeys
  - --talk-name=org.wiimotedev.deviceEvents
  - --talk-name=org.mpris.MediaPlayer2.Player
  - --own-name=org.mpris.MediaPlayer2.strawberry
  - --talk-name=org.kde.StatusNotifierWatcher
  - --own-name=org.kde.*
modules:
  - name: boost
    buildsystem: simple
    build-commands:
      - ./bootstrap.sh  --prefix="${FLATPAK_DEST}"
      - ./b2 -j ${FLATPAK_BUILDER_N_JOBS}
      - ./b2 -j ${FLATPAK_BUILDER_N_JOBS} headers
      - ./b2 install
    sources:
      - type: archive
        url: https://boostorg.jfrog.io/artifactory/main/release/1.81.0/source/boost_1_81_0.tar.gz
        sha256: 205666dea9f6a7cfed87c7a6dfbeb52a2c1b9de55712c9c1a87735d7181452b6
        x-checker-data:
          type: anitya
          project-id: 6845
          url-template: https://boostorg.jfrog.io/artifactory/main/release/$version/source/boost_${version0}_${version1}_$version2.tar.gz
  - name: chromaprint
    buildsystem: cmake-ninja
    sources:
      - type: archive
        url: https://github.com/acoustid/chromaprint/releases/download/v1.5.1/chromaprint-1.5.1.tar.gz
        sha256: a1aad8fa3b8b18b78d3755b3767faff9abb67242e01b478ec9a64e190f335e1c
        x-checker-data:
          type: anitya
          project-id: 286
          url-template: https://github.com/acoustid/chromaprint/releases/download/v$version/chromaprint-$version.tar.gz
  - name: protobuf
    cleanup:
      - /bin/protoc
    sources:
      - type: archive
        url: https://github.com/protocolbuffers/protobuf/releases/download/v21.8/protobuf-cpp-3.21.8.tar.gz
        sha256: f6251f2d00aad41b34c1dfa3d752713cb1bb1b7020108168a4deaa206ba8ed42
  - name: taglib
    buildsystem: cmake-ninja
    cleanup:
      - /bin/
    sources:
      - type: archive
        url: https://github.com/taglib/taglib/releases/download/v1.12/taglib-1.12.tar.gz
        sha256: 7fccd07669a523b07a15bd24c8da1bbb92206cb19e9366c3692af3d79253b703
  - name: libcdio
    config-opts:
      - --without-cd-drive
      - --without-cd-info
      - --without-cdda-player
      - --without-cd-read
      - --without-iso-info
      - --without-iso-read
      - --with-pic
      - --disable-static
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/libcdio/libcdio-2.1.0.tar.bz2
        sha256: 8550e9589dbd594bfac93b81ecf129b1dc9d0d51e90f9696f1b2f9b2af32712b
        x-checker-data:
          type: anitya
          project-id: 1573
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/libcdio/libcdio-$version.tar.bz2
    cleanup:
      - /bin
  - name: strawberry
    buildsystem: cmake-ninja
    post-install:
      - install -Dm755 start-strawberry.sh /app/bin/start-strawberry
    sources:
      - type: archive
        url: https://github.com/strawberrymusicplayer/strawberry/releases/download/1.0.15/strawberry-1.0.15.tar.xz
        sha256: 5470e72335dc9d3f6f4943387158cec067821a934e5d322de7d3ad4e8c50a9ef
        x-checker-data:
          type: json
          url: https://api.github.com/repos/strawberrymusicplayer/strawberry/releases/latest
          version-query: .tag_name
          url-query: .assets[] | select(.name=="strawberry-"+ $version +".tar.xz")
            | .browser_download_url
      - type: script
        dest-filename: start-strawberry.sh
        commands:
          - export TMPDIR=$XDG_RUNTIME_DIR/app/$FLATPAK_ID
          - /app/bin/strawberry "$@"
